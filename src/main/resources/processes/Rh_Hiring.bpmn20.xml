<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"  xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="sid-38422fae-e03e-43a3-bef4-bd33b32041b2" targetNamespace="http://bpmn.io/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="8.0.1">
  <process id="recruit_process" name="recruit process" isExecutable="true">
    <documentation>Hire an Applicant</documentation>
    <startEvent id="startEvent" name="start"></startEvent>
    <sequenceFlow id="flow2" sourceRef="startEvent" targetRef="storeResume" />
    <serviceTask id="storeResume" name="storeResume"  activiti:expression="${resumeService.storeResume(application.resumeId, resumeB64)}" >
      <documentation>Store CV</documentation>
    </serviceTask>
    <sequenceFlow id="flow3" sourceRef="storeResume" targetRef="reviewApplication" />
    <userTask id="reviewApplication" name="reviewApplication" activiti:candidateGroups="hr-managers" activiti:assignee="${application.recruiterMail}" >
    </userTask>
    <exclusiveGateway id="reviewdApplication"/>
    <sequenceFlow id="flow4_1" sourceRef="reviewApplication" targetRef="sendApproval" >
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${reviewCvOutcome == true}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow4_2" sourceRef="reviewApplication" targetRef="sendDecline" >
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${reviewCvOutcome == false}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="sendDecline" name="sendRejection" activiti:expression="${notificationService.sendMessage(application.name, response.rejection)}">
      </serviceTask>
      <serviceTask id="sendApproval" name="sendApproval"  activiti:expression="${notificationService.sendMessage(application.name, response.approval)}">
      </serviceTask>
      <endEvent id="endEventApproval" name="accepted"/>
      <endEvent id="endEventDecline" name="declined"/>
    </process>

  </definitions>
